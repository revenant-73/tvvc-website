<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TVVC Admin - Tryout Registrations</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Outfit:wght@600;700;800&display=swap" rel="stylesheet">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  
  <style>
    :root {
      --color-teal: #008080;
      --color-teal-dark: #006666;
      --color-coral: #ff6b6b;
      --color-coral-dark: #e05c5c;
      --color-dark: #121212;
      --color-dark-surface: #1a1a1a;
      --color-gray-100: #f5f5f5;
      --color-gray-200: #e0e0e0;
      --color-gray-300: #cccccc;
      --color-gray-400: #aaaaaa;
      --color-gray-500: #888888;
      --color-gray-600: #666666;
      --color-gray-700: #444444;
      --color-gray-800: #333333;
      --color-gray-900: #222222;
      --color-white: #ffffff;
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
      --spacing-2xl: 48px;
      --spacing-3xl: 64px;
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-full: 9999px;
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--color-dark);
      color: var(--color-white);
      line-height: 1.6;
      padding: 0;
      margin: 0;
    }
    
    h1, h2, h3, h4, h5, h6 {
      font-family: 'Outfit', sans-serif;
      font-weight: 700;
      margin-bottom: var(--spacing-md);
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--spacing-xl);
    }
    
    .header {
      background-color: var(--color-dark-surface);
      padding: var(--spacing-lg) 0;
      border-bottom: 1px solid var(--color-gray-800);
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--color-teal);
    }
    
    .logo span {
      color: var(--color-coral);
    }
    
    .admin-title {
      font-size: 0.9rem;
      color: var(--color-gray-400);
      margin-left: var(--spacing-md);
      padding-left: var(--spacing-md);
      border-left: 1px solid var(--color-gray-700);
    }
    
    .auth-section {
      background-color: var(--color-dark-surface);
      border-radius: var(--radius-lg);
      padding: var(--spacing-xl);
      margin-top: var(--spacing-xl);
      box-shadow: var(--shadow-lg);
      text-align: center;
    }
    
    .auth-form {
      max-width: 400px;
      margin: 0 auto;
    }
    
    .form-group {
      margin-bottom: var(--spacing-lg);
    }
    
    .form-label {
      display: block;
      margin-bottom: var(--spacing-xs);
      color: var(--color-gray-300);
      font-weight: 600;
      text-align: left;
    }
    
    .form-input {
      width: 100%;
      padding: var(--spacing-md);
      background-color: var(--color-gray-900);
      border: 1px solid var(--color-gray-700);
      border-radius: var(--radius-md);
      color: var(--color-white);
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--color-teal);
      box-shadow: 0 0 0 2px rgba(0, 128, 128, 0.2);
    }
    
    .btn {
      display: inline-block;
      padding: var(--spacing-md) var(--spacing-xl);
      background-color: var(--color-teal);
      color: var(--color-white);
      border: none;
      border-radius: var(--radius-md);
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }
    
    .btn:hover {
      background-color: var(--color-teal-dark);
      transform: translateY(-2px);
    }
    
    .btn-secondary {
      background-color: var(--color-gray-700);
    }
    
    .btn-secondary:hover {
      background-color: var(--color-gray-600);
    }
    
    .btn-coral {
      background-color: var(--color-coral);
    }
    
    .btn-coral:hover {
      background-color: var(--color-coral-dark);
    }
    
    .admin-panel {
      display: none;
    }
    
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-xl);
      padding-bottom: var(--spacing-md);
      border-bottom: 1px solid var(--color-gray-800);
    }
    
    .panel-title {
      font-size: 1.5rem;
      margin-bottom: 0;
    }
    
    .action-buttons {
      display: flex;
      gap: var(--spacing-md);
    }
    
    .registrations-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: var(--spacing-xl);
    }
    
    .registrations-table th,
    .registrations-table td {
      padding: var(--spacing-md);
      text-align: left;
      border-bottom: 1px solid var(--color-gray-800);
    }
    
    .registrations-table th {
      background-color: var(--color-gray-900);
      color: var(--color-gray-300);
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .registrations-table tbody tr {
      transition: background-color 0.3s ease;
    }
    
    .registrations-table tbody tr:hover {
      background-color: var(--color-gray-900);
    }
    
    .table-container {
      max-height: 600px;
      overflow-y: auto;
      border-radius: var(--radius-md);
      border: 1px solid var(--color-gray-800);
      margin-bottom: var(--spacing-xl);
    }
    
    .empty-state {
      text-align: center;
      padding: var(--spacing-3xl) var(--spacing-xl);
      color: var(--color-gray-500);
    }
    
    .empty-icon {
      font-size: 3rem;
      margin-bottom: var(--spacing-lg);
      color: var(--color-gray-700);
    }
    
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
    }
    
    .stat-card {
      background-color: var(--color-dark-surface);
      border-radius: var(--radius-md);
      padding: var(--spacing-lg);
      box-shadow: var(--shadow-md);
      border-left: 4px solid var(--color-teal);
    }
    
    .stat-title {
      font-size: 0.9rem;
      color: var(--color-gray-400);
      margin-bottom: var(--spacing-xs);
    }
    
    .stat-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--color-white);
    }
    
    .error-message {
      color: var(--color-coral);
      margin-top: var(--spacing-xs);
      font-size: 0.9rem;
      text-align: left;
    }
    
    .success-message {
      background-color: rgba(0, 128, 128, 0.1);
      color: var(--color-teal);
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      margin-bottom: var(--spacing-lg);
      display: flex;
      align-items: center;
    }
    
    .success-message i {
      margin-right: var(--spacing-sm);
    }
    
    .footer {
      margin-top: var(--spacing-3xl);
      padding-top: var(--spacing-lg);
      border-top: 1px solid var(--color-gray-800);
      color: var(--color-gray-500);
      font-size: 0.9rem;
      text-align: center;
    }
    
    @media (max-width: 768px) {
      .container {
        padding: var(--spacing-lg);
      }
      
      .header-content {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .admin-title {
        margin-left: 0;
        padding-left: 0;
        border-left: none;
        margin-top: var(--spacing-xs);
      }
      
      .panel-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .action-buttons {
        margin-top: var(--spacing-md);
      }
      
      .stats-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="container header-content">
      <div style="display: flex; align-items: center;">
        <div class="logo">TVVC<span>.</span></div>
        <div class="admin-title">Admin Dashboard</div>
      </div>
      <div id="auth-status">
        <button id="logout-btn" class="btn btn-secondary" style="display: none;">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </div>
  </header>
  
  <main class="container">
    <section id="auth-section" class="auth-section">
      <h2>Admin Login</h2>
      <p style="margin-bottom: var(--spacing-lg); color: var(--color-gray-400);">
        Please enter your email and password to access the tryout registration data.
      </p>
      
      <form id="auth-form" class="auth-form">
        <div class="form-group">
          <label for="email" class="form-label">Email</label>
          <input type="email" id="email" class="form-input" required>
        </div>
        
        <div class="form-group">
          <label for="password" class="form-label">Password</label>
          <input type="password" id="password" class="form-input" required>
          <div id="auth-error" class="error-message" style="display: none;"></div>
        </div>
        
        <button type="submit" class="btn" style="width: 100%;">
          <i class="fas fa-lock"></i> Login
        </button>
      </form>
    </section>
    
    <section id="admin-panel" class="admin-panel">
      <div id="success-message" class="success-message" style="display: none;">
        <i class="fas fa-check-circle"></i>
        <span id="success-text">Operation completed successfully!</span>
      </div>
      
      <div class="panel-header">
        <h2 class="panel-title">Tryout Registrations</h2>
        
        <div class="action-buttons">
          <button id="export-csv-btn" class="btn">
            <i class="fas fa-file-csv"></i> Export CSV
          </button>
          <button id="clear-data-btn" class="btn btn-secondary">
            <i class="fas fa-trash"></i> Clear Data
          </button>
        </div>
      </div>
      
      <div class="stats-container">
        <div class="stat-card">
          <div class="stat-title">Total Registrations</div>
          <div id="total-registrations" class="stat-value">0</div>
        </div>
        
        <div class="stat-card" style="border-left-color: var(--color-coral);">
          <div class="stat-title">Age Groups</div>
          <div id="age-groups" class="stat-value">0</div>
        </div>
        
        <div class="stat-card" style="border-left-color: #9c27b0;">
          <div class="stat-title">Latest Registration</div>
          <div id="latest-registration" class="stat-value">-</div>
        </div>
      </div>
      
      <div class="table-container">
        <table class="registrations-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Player Name</th>
              <th>Birth Date</th>
              <th>Age Group</th>
              <th>Position</th>
              <th>Parent Email</th>
              <th>Parent Phone</th>
            </tr>
          </thead>
          <tbody id="registrations-table-body">
            <!-- Table rows will be added dynamically -->
          </tbody>
        </table>
        
        <div id="empty-state" class="empty-state">
          <div class="empty-icon">
            <i class="fas fa-clipboard-list"></i>
          </div>
          <h3>No Registrations Yet</h3>
          <p>When players register for tryouts, they will appear here.</p>
        </div>
      </div>
    </section>
  </main>
  
  <footer class="footer container">
    <p>&copy; 2023 Tualatin Valley Volleyball Club. All rights reserved.</p>
  </footer>
  
  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDmsZlmti2s_-tnmfzu2dl3JXHc-O_MFIo",
      authDomain: "tvvc-website.firebaseapp.com",
      projectId: "tvvc-website",
      storageBucket: "tvvc-website.firebasestorage.app",
      messagingSenderId: "235626883938",
      appId: "1:235626883938:web:109885d0682b9080bd1a3b"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Initialize Firestore
    const db = firebase.firestore();

    // Initialize Firebase Auth
    const auth = firebase.auth();

    // Collection references
    const registrationsCollection = db.collection('tryout-registrations');
    
    // DOM Elements
    const authSection = document.getElementById('auth-section');
    const authForm = document.getElementById('auth-form');
    const authError = document.getElementById('auth-error');
    const adminPanel = document.getElementById('admin-panel');
    const logoutBtn = document.getElementById('logout-btn');
    const exportCsvBtn = document.getElementById('export-csv-btn');
    const clearDataBtn = document.getElementById('clear-data-btn');
    const registrationsTableBody = document.getElementById('registrations-table-body');
    const emptyState = document.getElementById('empty-state');
    const totalRegistrationsEl = document.getElementById('total-registrations');
    const ageGroupsEl = document.getElementById('age-groups');
    const latestRegistrationEl = document.getElementById('latest-registration');
    const successMessage = document.getElementById('success-message');
    const successText = document.getElementById('success-text');
    
    // Check if user is already authenticated with Firebase
    function checkAuth() {
      // Show loading state
      showLoadingState();
      
      // Check Firebase authentication state
      auth.onAuthStateChanged(function(user) {
        if (user) {
          // User is signed in
          console.log("User is signed in:", user.email);
          showAdminPanel();
        } else {
          // No user is signed in
          console.log("No user is signed in");
          showAuthForm();
        }
      });
    }
    
    // Show loading state
    function showLoadingState() {
      authSection.style.display = 'block';
      adminPanel.style.display = 'none';
      logoutBtn.style.display = 'none';
      
      // Disable form
      if (authForm) {
        const submitBtn = authForm.querySelector('button[type="submit"]');
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
        }
      }
    }
    
    // Show the authentication form
    function showAuthForm() {
      authSection.style.display = 'block';
      adminPanel.style.display = 'none';
      logoutBtn.style.display = 'none';
      
      // Enable form
      if (authForm) {
        const submitBtn = authForm.querySelector('button[type="submit"]');
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.innerHTML = '<i class="fas fa-lock"></i> Login';
        }
      }
    }
    
    // Show the admin panel
    function showAdminPanel() {
      authSection.style.display = 'none';
      adminPanel.style.display = 'block';
      logoutBtn.style.display = 'inline-block';
      
      // Load registrations data from Firestore
      loadRegistrationsFromFirestore();
    }
    
    // Handle authentication form submission
    authForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      // Show loading state
      const submitBtn = authForm.querySelector('button[type="submit"]');
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
      }
      
      // Hide previous error
      authError.style.display = 'none';
      
      // Sign in with Firebase using email and password from form
      auth.signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          // Signed in successfully
          console.log("Signed in successfully");
          
          // Clear form fields
          document.getElementById('email').value = '';
          document.getElementById('password').value = '';
          
          // Show admin panel (this will happen automatically via onAuthStateChanged)
        })
        .catch((error) => {
          console.error("Authentication error:", error);
          
          // Show error message
          authError.textContent = 'Login failed: ' + error.message;
          authError.style.display = 'block';
          
          // Reset button
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-lock"></i> Login';
          }
        });
    });
    
    // Handle logout
    logoutBtn.addEventListener('click', function() {
      // Sign out from Firebase
      auth.signOut()
        .then(() => {
          // Sign-out successful
          console.log("Signed out successfully");
          // Show auth form (this will happen automatically via onAuthStateChanged)
        })
        .catch((error) => {
          // An error happened
          console.error("Sign out error:", error);
        });
    });
    
    // Load registrations from Firestore
    function loadRegistrationsFromFirestore() {
      // Show loading state
      registrationsTableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px;"><i class="fas fa-spinner fa-spin"></i> Loading registrations...</td></tr>';
      
      // Get registrations from Firestore
      registrationsCollection.orderBy('timestamp', 'desc').get()
        .then((querySnapshot) => {
          // Convert to array of registration objects
          const registrations = [];
          querySnapshot.forEach((doc) => {
            const data = doc.data();
            data.id = doc.id; // Add document ID
            registrations.push(data);
          });
          
          // Display registrations
          displayRegistrations(registrations);
          
          // Update stats
          updateStats(registrations);
        })
        .catch((error) => {
          console.error("Error getting registrations:", error);
          registrationsTableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--color-coral);"><i class="fas fa-exclamation-circle"></i> Error loading registrations. Please try again.</td></tr>';
        });
    }
    
    // Display registrations in the table
    function displayRegistrations(registrations) {
      // Clear table body
      registrationsTableBody.innerHTML = '';
      
      // Check if there are any registrations
      if (registrations.length === 0) {
        // Show empty state
        emptyState.style.display = 'block';
        return;
      }
      
      // Hide empty state
      emptyState.style.display = 'none';
      
      // Add registrations to table
      registrations.forEach(registration => {
        const row = document.createElement('tr');
        
        // Format date
        let formattedDate = 'Unknown';
        if (registration.timestamp) {
          const date = new Date(registration.timestamp);
          formattedDate = `${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
        }
        
        row.innerHTML = `
          <td>${formattedDate}</td>
          <td>${registration.playerName || ''}</td>
          <td>${registration.birthDate || ''}</td>
          <td>${registration.ageGroup || ''}</td>
          <td>${registration.position || ''}</td>
          <td>${registration.parentEmail || ''}</td>
          <td>${registration.parentPhone || ''}</td>
        `;
        
        // Add data-id attribute for potential future use (e.g., editing or deleting)
        if (registration.id) {
          row.setAttribute('data-id', registration.id);
        }
        
        registrationsTableBody.appendChild(row);
      });
    }
    
    // Update statistics
    function updateStats(registrations) {
      // Total registrations
      totalRegistrationsEl.textContent = registrations.length;
      
      // Age groups
      const ageGroups = new Set();
      registrations.forEach(registration => {
        if (registration.ageGroup) {
          ageGroups.add(registration.ageGroup);
        }
      });
      ageGroupsEl.textContent = ageGroups.size;
      
      // Latest registration
      if (registrations.length > 0) {
        // Get latest date (registrations are already sorted by timestamp desc)
        let latestDate;
        for (const reg of registrations) {
          if (reg.timestamp) {
            latestDate = new Date(reg.timestamp);
            break;
          }
        }
        
        if (latestDate) {
          const now = new Date();
          const diffTime = Math.abs(now - latestDate);
          const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
          
          if (diffDays === 0) {
            latestRegistrationEl.textContent = 'Today';
          } else if (diffDays === 1) {
            latestRegistrationEl.textContent = 'Yesterday';
          } else {
            latestRegistrationEl.textContent = `${diffDays} days ago`;
          }
        } else {
          latestRegistrationEl.textContent = 'Unknown';
        }
      } else {
        latestRegistrationEl.textContent = '-';
      }
    }
    
    // Export registrations as CSV
    exportCsvBtn.addEventListener('click', function() {
      // Show loading state
      exportCsvBtn.disabled = true;
      exportCsvBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Exporting...';
      
      // Get registrations from Firestore
      registrationsCollection.orderBy('timestamp', 'desc').get()
        .then((querySnapshot) => {
          // Convert to array of registration objects
          const registrations = [];
          querySnapshot.forEach((doc) => {
            registrations.push(doc.data());
          });
          
          if (registrations.length === 0) {
            showSuccessMessage('No registrations to export.', 'warning');
            exportCsvBtn.disabled = false;
            exportCsvBtn.innerHTML = '<i class="fas fa-file-csv"></i> Export CSV';
            return;
          }
          
          // CSV Headers
          const headers = [
            'Timestamp',
            'Player Name',
            'Birth Date',
            'Age Group',
            'Position',
            'Parent Email',
            'Parent Phone'
          ];
          
          // Create CSV content
          let csvContent = headers.join(',') + '\n';
          
          // Add registrations to CSV
          registrations.forEach(registration => {
            const row = [
              registration.timestamp || '',
              `"${(registration.playerName || '').replace(/"/g, '""')}"`,
              registration.birthDate || '',
              registration.ageGroup || '',
              registration.position || '',
              `"${(registration.parentEmail || '').replace(/"/g, '""')}"`,
              `"${(registration.parentPhone || '').replace(/"/g, '""')}"`
            ];
            
            csvContent += row.join(',') + '\n';
          });
          
          // Create download link
          const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          
          // Set link attributes
          link.setAttribute('href', url);
          link.setAttribute('download', `tvvc-tryout-registrations-${new Date().toISOString().split('T')[0]}.csv`);
          link.style.display = 'none';
          
          // Add link to document
          document.body.appendChild(link);
          
          // Click link to download
          link.click();
          
          // Clean up
          document.body.removeChild(link);
          
          // Show success message
          showSuccessMessage('Registrations exported successfully!');
          
          // Reset button
          exportCsvBtn.disabled = false;
          exportCsvBtn.innerHTML = '<i class="fas fa-file-csv"></i> Export CSV';
        })
        .catch((error) => {
          console.error("Error exporting registrations:", error);
          showSuccessMessage('Error exporting registrations. Please try again.', 'warning');
          
          // Reset button
          exportCsvBtn.disabled = false;
          exportCsvBtn.innerHTML = '<i class="fas fa-file-csv"></i> Export CSV';
        });
    });
    
    // Clear registrations data
    clearDataBtn.addEventListener('click', function() {
      if (confirm('Are you sure you want to clear all registration data? This cannot be undone.')) {
        // Show loading state
        clearDataBtn.disabled = true;
        clearDataBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Clearing...';
        
        // Get all registrations
        registrationsCollection.get()
          .then((querySnapshot) => {
            // Create a batch to delete all documents
            const batch = db.batch();
            
            // Add each document to the batch
            querySnapshot.forEach((doc) => {
              batch.delete(doc.ref);
            });
            
            // Commit the batch
            return batch.commit();
          })
          .then(() => {
            console.log("All registrations deleted successfully");
            
            // Reload registrations
            loadRegistrationsFromFirestore();
            
            // Show success message
            showSuccessMessage('All registration data has been cleared.');
            
            // Reset button
            clearDataBtn.disabled = false;
            clearDataBtn.innerHTML = '<i class="fas fa-trash"></i> Clear Data';
          })
          .catch((error) => {
            console.error("Error clearing registrations:", error);
            showSuccessMessage('Error clearing registrations. Please try again.', 'warning');
            
            // Reset button
            clearDataBtn.disabled = false;
            clearDataBtn.innerHTML = '<i class="fas fa-trash"></i> Clear Data';
          });
      }
    });
    
    // Show success message
    function showSuccessMessage(message, type = 'success') {
      successText.textContent = message;
      
      if (type === 'warning') {
        successMessage.style.backgroundColor = 'rgba(255, 152, 0, 0.1)';
        successMessage.style.color = '#ff9800';
      } else {
        successMessage.style.backgroundColor = 'rgba(0, 128, 128, 0.1)';
        successMessage.style.color = 'var(--color-teal)';
      }
      
      successMessage.style.display = 'flex';
      
      // Hide message after 5 seconds
      setTimeout(() => {
        successMessage.style.display = 'none';
      }, 5000);
    }
    
    // Initialize
    checkAuth();
  </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TVVC Admin - Tryout Registrations</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Outfit:wght@600;700;800&display=swap" rel="stylesheet">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  
  <style>
    :root {
      --color-teal: #008080;
      --color-teal-dark: #006666;
      --color-coral: #ff6b6b;
      --color-coral-dark: #e05c5c;
      --color-dark: #121212;
      --color-dark-surface: #1a1a1a;
      --color-gray-100: #f5f5f5;
      --color-gray-200: #e0e0e0;
      --color-gray-300: #cccccc;
      --color-gray-400: #aaaaaa;
      --color-gray-500: #888888;
      --color-gray-600: #666666;
      --color-gray-700: #444444;
      --color-gray-800: #333333;
      --color-gray-900: #222222;
      --color-white: #ffffff;
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
      --spacing-2xl: 48px;
      --spacing-3xl: 64px;
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-full: 9999px;
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--color-dark);
      color: var(--color-white);
      line-height: 1.6;
      padding: 0;
      margin: 0;
    }
    
    h1, h2, h3, h4, h5, h6 {
      font-family: 'Outfit', sans-serif;
      font-weight: 700;
      margin-bottom: var(--spacing-md);
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--spacing-xl);
    }
    
    .header {
      background-color: var(--color-dark-surface);
      padding: var(--spacing-lg) 0;
      border-bottom: 1px solid var(--color-gray-800);
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--color-teal);
    }
    
    .logo span {
      color: var(--color-coral);
    }
    
    .admin-title {
      font-size: 0.9rem;
      color: var(--color-gray-400);
      margin-left: var(--spacing-md);
      padding-left: var(--spacing-md);
      border-left: 1px solid var(--color-gray-700);
    }
    
    .auth-section {
      background-color: var(--color-dark-surface);
      border-radius: var(--radius-lg);
      padding: var(--spacing-xl);
      margin-top: var(--spacing-xl);
      box-shadow: var(--shadow-lg);
      text-align: center;
    }
    
    .auth-form {
      max-width: 400px;
      margin: 0 auto;
    }
    
    .form-group {
      margin-bottom: var(--spacing-lg);
    }
    
    .form-label {
      display: block;
      margin-bottom: var(--spacing-xs);
      color: var(--color-gray-300);
      font-weight: 600;
      text-align: left;
    }
    
    .form-input {
      width: 100%;
      padding: var(--spacing-md);
      background-color: var(--color-gray-900);
      border: 1px solid var(--color-gray-700);
      border-radius: var(--radius-md);
      color: var(--color-white);
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--color-teal);
      box-shadow: 0 0 0 2px rgba(0, 128, 128, 0.2);
    }
    
    .btn {
      display: inline-block;
      padding: var(--spacing-md) var(--spacing-xl);
      background-color: var(--color-teal);
      color: var(--color-white);
      border: none;
      border-radius: var(--radius-md);
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }
    
    .btn:hover {
      background-color: var(--color-teal-dark);
      transform: translateY(-2px);
    }
    
    .btn-secondary {
      background-color: var(--color-gray-700);
    }
    
    .btn-secondary:hover {
      background-color: var(--color-gray-600);
    }
    
    .btn-coral {
      background-color: var(--color-coral);
    }
    
    .btn-coral:hover {
      background-color: var(--color-coral-dark);
    }
    
    .admin-panel {
      display: none;
    }
    
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-xl);
      padding-bottom: var(--spacing-md);
      border-bottom: 1px solid var(--color-gray-800);
    }
    
    .panel-title {
      font-size: 1.5rem;
      margin-bottom: 0;
    }
    
    .action-buttons {
      display: flex;
      gap: var(--spacing-md);
    }
    
    .registrations-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: var(--spacing-xl);
    }
    
    .registrations-table th,
    .registrations-table td {
      padding: var(--spacing-md);
      text-align: left;
      border-bottom: 1px solid var(--color-gray-800);
    }
    
    .registrations-table th {
      background-color: var(--color-gray-900);
      color: var(--color-gray-300);
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .registrations-table tbody tr {
      transition: background-color 0.3s ease;
    }
    
    .registrations-table tbody tr:hover {
      background-color: var(--color-gray-900);
    }
    
    .table-container {
      max-height: 600px;
      overflow-y: auto;
      border-radius: var(--radius-md);
      border: 1px solid var(--color-gray-800);
      margin-bottom: var(--spacing-xl);
    }
    
    .empty-state {
      text-align: center;
      padding: var(--spacing-3xl) var(--spacing-xl);
      color: var(--color-gray-500);
    }
    
    .empty-icon {
      font-size: 3rem;
      margin-bottom: var(--spacing-lg);
      color: var(--color-gray-700);
    }
    
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
    }
    
    .stat-card {
      background-color: var(--color-dark-surface);
      border-radius: var(--radius-md);
      padding: var(--spacing-lg);
      box-shadow: var(--shadow-md);
      border-left: 4px solid var(--color-teal);
    }
    
    .stat-title {
      font-size: 0.9rem;
      color: var(--color-gray-400);
      margin-bottom: var(--spacing-xs);
    }
    
    .stat-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--color-white);
    }
    
    .error-message {
      color: var(--color-coral);
      margin-top: var(--spacing-xs);
      font-size: 0.9rem;
      text-align: left;
    }
    
    .success-message {
      background-color: rgba(0, 128, 128, 0.1);
      color: var(--color-teal);
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      margin-bottom: var(--spacing-lg);
      display: flex;
      align-items: center;
    }
    
    .success-message i {
      margin-right: var(--spacing-sm);
    }
    
    .footer {
      margin-top: var(--spacing-3xl);
      padding-top: var(--spacing-lg);
      border-top: 1px solid var(--color-gray-800);
      color: var(--color-gray-500);
      font-size: 0.9rem;
      text-align: center;
    }
    
    @media (max-width: 768px) {
      .container {
        padding: var(--spacing-lg);
      }
      
      .header-content {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .admin-title {
        margin-left: 0;
        padding-left: 0;
        border-left: none;
        margin-top: var(--spacing-xs);
      }
      
      .panel-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .action-buttons {
        margin-top: var(--spacing-md);
      }
      
      .stats-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="container header-content">
      <div style="display: flex; align-items: center;">
        <div class="logo">TVVC<span>.</span></div>
        <div class="admin-title">Admin Dashboard</div>
      </div>
      <div id="auth-status">
        <button id="logout-btn" class="btn btn-secondary" style="display: none;">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </div>
  </header>
  
  <main class="container">
    <section id="auth-section" class="auth-section">
      <h2>Admin Login</h2>
      <p style="margin-bottom: var(--spacing-lg); color: var(--color-gray-400);">
        Please enter your email and password to access the tryout registration data.
      </p>
      
      <form id="auth-form" class="auth-form">
        <div class="form-group">
          <label for="email" class="form-label">Email</label>
          <input type="email" id="email" class="form-input" required>
        </div>
        
        <div class="form-group">
          <label for="password" class="form-label">Password</label>
          <input type="password" id="password" class="form-input" required>
          <div id="auth-error" class="error-message" style="display: none;"></div>
        </div>
        
        <button type="submit" class="btn" style="width: 100%;">
          <i class="fas fa-lock"></i> Login
        </button>
      </form>
    </section>
    
    <section id="admin-panel" class="admin-panel">
      <div id="success-message" class="success-message" style="display: none;">
        <i class="fas fa-check-circle"></i>
        <span id="success-text">Operation completed successfully!</span>
      </div>
      
      <div class="panel-header">
        <h2 class="panel-title">Tryout Registrations</h2>
        
        <div class="action-buttons">
          <button id="export-csv-btn" class="btn">
            <i class="fas fa-file-csv"></i> Export CSV
          </button>
          <button id="clear-data-btn" class="btn btn-secondary">
            <i class="fas fa-trash"></i> Clear Data
          </button>
        </div>
      </div>
      
      <div class="stats-container">
        <div class="stat-card">
          <div class="stat-title">Total Registrations</div>
          <div id="total-registrations" class="stat-value">0</div>
        </div>
        
        <div class="stat-card" style="border-left-color: var(--color-coral);">
          <div class="stat-title">Age Groups</div>
          <div id="age-groups" class="stat-value">0</div>
        </div>
        
        <div class="stat-card" style="border-left-color: #9c27b0;">
          <div class="stat-title">Latest Registration</div>
          <div id="latest-registration" class="stat-value">-</div>
        </div>
      </div>
      
      <div class="table-container">
        <table class="registrations-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Player Name</th>
              <th>Birth Date</th>
              <th>Age Group</th>
              <th>Position</th>
              <th>Parent Email</th>
              <th>Parent Phone</th>
            </tr>
          </thead>
          <tbody id="registrations-table-body">
            <!-- Table rows will be added dynamically -->
          </tbody>
        </table>
        
        <div id="empty-state" class="empty-state">
          <div class="empty-icon">
            <i class="fas fa-clipboard-list"></i>
          </div>
          <h3>No Registrations Yet</h3>
          <p>When players register for tryouts, they will appear here.</p>
        </div>
      </div>
    </section>
  </main>
  
  <footer class="footer container">
    <p>&copy; 2023 Tualatin Valley Volleyball Club. All rights reserved.</p>
  </footer>
  
  <script>
    // Firebase and DOM elements are already initialized in the previous script tag
    
    // Check if user is already authenticated with Firebase
    function checkAuth() {
      // Show loading state
      showLoadingState();
      
      // Check Firebase authentication state
      auth.onAuthStateChanged(function(user) {
        if (user) {
          // User is signed in
          console.log("User is signed in:", user.email);
          showAdminPanel();
        } else {
          // No user is signed in
          console.log("No user is signed in");
          showAuthForm();
        }
      });
    }
    
    // Show loading state
    function showLoadingState() {
      authSection.style.display = 'block';
      adminPanel.style.display = 'none';
      logoutBtn.style.display = 'none';
      
      // Disable form
      if (authForm) {
        const submitBtn = authForm.querySelector('button[type="submit"]');
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
        }
      }
    }
    
    // Show the authentication form
    function showAuthForm() {
      authSection.style.display = 'block';
      adminPanel.style.display = 'none';
      logoutBtn.style.display = 'none';
      
      // Enable form
      if (authForm) {
        const submitBtn = authForm.querySelector('button[type="submit"]');
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.innerHTML = '<i class="fas fa-lock"></i> Login';
        }
      }
    }
    
    // Show the admin panel
    function showAdminPanel() {
      authSection.style.display = 'none';
      adminPanel.style.display = 'block';
      logoutBtn.style.display = 'inline-block';
      
      // Load registrations data from Firestore
      loadRegistrationsFromFirestore();
    }
    
    // Handle authentication form submission
    authForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      // Show loading state
      const submitBtn = authForm.querySelector('button[type="submit"]');
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
      }
      
      // Hide previous error
      authError.style.display = 'none';
      
      // Sign in with Firebase using email and password from form
      auth.signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          // Signed in successfully
          console.log("Signed in successfully");
          
          // Clear form fields
          document.getElementById('email').value = '';
          document.getElementById('password').value = '';
          
          // Show admin panel (this will happen automatically via onAuthStateChanged)
        })
        .catch((error) => {
          console.error("Authentication error:", error);
          
          // Show error message
          authError.textContent = 'Login failed: ' + error.message;
          authError.style.display = 'block';
          
          // Reset button
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-lock"></i> Login';
          }
        });
    });
    
    // Handle logout
    logoutBtn.addEventListener('click', function() {
      // Sign out from Firebase
      auth.signOut()
        .then(() => {
          // Sign-out successful
          console.log("Signed out successfully");
          // Show auth form (this will happen automatically via onAuthStateChanged)
        })
        .catch((error) => {
          // An error happened
          console.error("Sign out error:", error);
        });
    });
    
    // Load registrations from Firestore
    function loadRegistrationsFromFirestore() {
      // Show loading state
      registrationsTableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px;"><i class="fas fa-spinner fa-spin"></i> Loading registrations...</td></tr>';
      
      // Get registrations from Firestore
      registrationsCollection.orderBy('timestamp', 'desc').get()
        .then((querySnapshot) => {
          // Convert to array of registration objects
          const registrations = [];
          querySnapshot.forEach((doc) => {
            const data = doc.data();
            data.id = doc.id; // Add document ID
            registrations.push(data);
          });
          
          // Display registrations
          displayRegistrations(registrations);
          
          // Update stats
          updateStats(registrations);
        })
        .catch((error) => {
          console.error("Error getting registrations:", error);
          registrationsTableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--color-coral);"><i class="fas fa-exclamation-circle"></i> Error loading registrations. Please try again.</td></tr>';
        });
    }
    
    // Display registrations in the table
    function displayRegistrations(registrations) {
      // Clear table body
      registrationsTableBody.innerHTML = '';
      
      // Check if there are any registrations
      if (registrations.length === 0) {
        // Show empty state
        emptyState.style.display = 'block';
        return;
      }
      
      // Hide empty state
      emptyState.style.display = 'none';
      
      // Add registrations to table
      registrations.forEach(registration => {
        const row = document.createElement('tr');
        
        // Format date
        let formattedDate = 'Unknown';
        if (registration.timestamp) {
          const date = new Date(registration.timestamp);
          formattedDate = `${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
        }
        
        row.innerHTML = `
          <td>${formattedDate}</td>
          <td>${registration.playerName || ''}</td>
          <td>${registration.birthDate || ''}</td>
          <td>${registration.ageGroup || ''}</td>
          <td>${registration.position || ''}</td>
          <td>${registration.parentEmail || ''}</td>
          <td>${registration.parentPhone || ''}</td>
        `;
        
        // Add data-id attribute for potential future use (e.g., editing or deleting)
        if (registration.id) {
          row.setAttribute('data-id', registration.id);
        }
        
        registrationsTableBody.appendChild(row);
      });
    }
    
    // Update statistics
    function updateStats(registrations) {
      // Total registrations
      totalRegistrationsEl.textContent = registrations.length;
      
      // Age groups
      const ageGroups = new Set();
      registrations.forEach(registration => {
        if (registration.ageGroup) {
          ageGroups.add(registration.ageGroup);
        }
      });
      ageGroupsEl.textContent = ageGroups.size;
      
      // Latest registration
      if (registrations.length > 0) {
        // Get latest date (registrations are already sorted by timestamp desc)
        let latestDate;
        for (const reg of registrations) {
          if (reg.timestamp) {
            latestDate = new Date(reg.timestamp);
            break;
          }
        }
        
        if (latestDate) {
          const now = new Date();
          const diffTime = Math.abs(now - latestDate);
          const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
          
          if (diffDays === 0) {
            latestRegistrationEl.textContent = 'Today';
          } else if (diffDays === 1) {
            latestRegistrationEl.textContent = 'Yesterday';
          } else {
            latestRegistrationEl.textContent = `${diffDays} days ago`;
          }
        } else {
          latestRegistrationEl.textContent = 'Unknown';
        }
      } else {
        latestRegistrationEl.textContent = '-';
      }
    }
    
    // Export registrations as CSV
    exportCsvBtn.addEventListener('click', function() {
      // Show loading state
      exportCsvBtn.disabled = true;
      exportCsvBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Exporting...';
      
      // Get registrations from Firestore
      registrationsCollection.orderBy('timestamp', 'desc').get()
        .then((querySnapshot) => {
          // Convert to array of registration objects
          const registrations = [];
          querySnapshot.forEach((doc) => {
            registrations.push(doc.data());
          });
          
          if (registrations.length === 0) {
            showSuccessMessage('No registrations to export.', 'warning');
            exportCsvBtn.disabled = false;
            exportCsvBtn.innerHTML = '<i class="fas fa-file-csv"></i> Export CSV';
            return;
          }
          
          // CSV Headers
          const headers = [
            'Timestamp',
            'Player Name',
            'Birth Date',
            'Age Group',
            'Position',
            'Parent Email',
            'Parent Phone'
          ];
          
          // Create CSV content
          let csvContent = headers.join(',') + '\n';
          
          // Add registrations to CSV
          registrations.forEach(registration => {
            const row = [
              registration.timestamp || '',
              `"${(registration.playerName || '').replace(/"/g, '""')}"`,
              registration.birthDate || '',
              registration.ageGroup || '',
              registration.position || '',
              `"${(registration.parentEmail || '').replace(/"/g, '""')}"`,
              `"${(registration.parentPhone || '').replace(/"/g, '""')}"`
            ];
            
            csvContent += row.join(',') + '\n';
          });
          
          // Create download link
          const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          
          // Set link attributes
          link.setAttribute('href', url);
          link.setAttribute('download', `tvvc-tryout-registrations-${new Date().toISOString().split('T')[0]}.csv`);
          link.style.display = 'none';
          
          // Add link to document
          document.body.appendChild(link);
          
          // Click link to download
          link.click();
          
          // Clean up
          document.body.removeChild(link);
          
          // Show success message
          showSuccessMessage('Registrations exported successfully!');
          
          // Reset button
          exportCsvBtn.disabled = false;
          exportCsvBtn.innerHTML = '<i class="fas fa-file-csv"></i> Export CSV';
        })
        .catch((error) => {
          console.error("Error exporting registrations:", error);
          showSuccessMessage('Error exporting registrations. Please try again.', 'warning');
          
          // Reset button
          exportCsvBtn.disabled = false;
          exportCsvBtn.innerHTML = '<i class="fas fa-file-csv"></i> Export CSV';
        });
    });
    
    // Clear registrations data
    clearDataBtn.addEventListener('click', function() {
      if (confirm('Are you sure you want to clear all registration data? This cannot be undone.')) {
        // Show loading state
        clearDataBtn.disabled = true;
        clearDataBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Clearing...';
        
        // Get all registrations
        registrationsCollection.get()
          .then((querySnapshot) => {
            // Create a batch to delete all documents
            const batch = db.batch();
            
            // Add each document to the batch
            querySnapshot.forEach((doc) => {
              batch.delete(doc.ref);
            });
            
            // Commit the batch
            return batch.commit();
          })
          .then(() => {
            console.log("All registrations deleted successfully");
            
            // Reload registrations
            loadRegistrationsFromFirestore();
            
            // Show success message
            showSuccessMessage('All registration data has been cleared.');
            
            // Reset button
            clearDataBtn.disabled = false;
            clearDataBtn.innerHTML = '<i class="fas fa-trash"></i> Clear Data';
          })
          .catch((error) => {
            console.error("Error clearing registrations:", error);
            showSuccessMessage('Error clearing registrations. Please try again.', 'warning');
            
            // Reset button
            clearDataBtn.disabled = false;
            clearDataBtn.innerHTML = '<i class="fas fa-trash"></i> Clear Data';
          });
      }
    });
    
    // Show success message
    function showSuccessMessage(message, type = 'success') {
      successText.textContent = message;
      
      if (type === 'warning') {
        successMessage.style.backgroundColor = 'rgba(255, 152, 0, 0.1)';
        successMessage.style.color = '#ff9800';
      } else {
        successMessage.style.backgroundColor = 'rgba(0, 128, 128, 0.1)';
        successMessage.style.color = 'var(--color-teal)';
      }
      
      successMessage.style.display = 'flex';
      
      // Hide message after 5 seconds
      setTimeout(() => {
        successMessage.style.display = 'none';
      }, 5000);
    }
    
    // Initialize
    checkAuth();
  </script>
</body>
</html>